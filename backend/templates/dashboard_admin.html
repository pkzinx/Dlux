{% extends 'base.html' %}
{% block title %}Painel Administrativo{% endblock %}
{% block content %}
<div class="row g-3 mb-4">
  <div class="col-sm-6 col-lg-3">
    <div class="card card-panel">
      <div class="card-body">
        <div class="kpi">{{ kpis.barbers_count }}</div>
        <div class="kpi-label">Barbeiros</div>
      </div>
    </div>
  </div>
  <div class="col-sm-6 col-lg-3">
    <div class="card card-panel">
      <div class="card-body">
        <div class="kpi">{{ kpis.appointments_count }}</div>
        <div class="kpi-label">Agendamentos Hoje</div>
      </div>
    </div>
  </div>
  <div class="col-sm-6 col-lg-3">
    <div class="card card-panel">
      <div class="card-body">
        <div class="kpi">{{ kpis.sales_count }}</div>
        <div class="kpi-label">Vendas Hoje</div>
      </div>
    </div>
  </div>
  <div class="col-sm-6 col-lg-3">
    <div class="card card-panel">
      <div class="card-body">
        <div class="kpi">R$ {{ kpis.sales_total }}</div>
        <div class="kpi-label">Faturamento do Dia</div>
      </div>
    </div>
  </div>
</div>

<div class="row g-3">
  <div class="col-lg-6">
    <div class="card card-panel mb-4">
      <div class="card-header fw-semibold">Status dos agendamentos de hoje</div>
      <div class="card-body">
        {% if status_breakdown %}
          <div class="d-flex flex-wrap gap-2">
            {% for item in status_breakdown %}
              {% if item.status == 'scheduled' %}
                <span class="badge rounded-pill text-bg-secondary">Agendado: {{ item.c }}</span>
              {% elif item.status == 'completed' %}
                <span class="badge rounded-pill bg-success">Concluído: {{ item.c }}</span>
              {% elif item.status == 'cancelled' %}
                <span class="badge rounded-pill bg-danger">Cancelado: {{ item.c }}</span>
              {% elif item.status == 'no_show' %}
                <span class="badge rounded-pill bg-warning text-dark">Faltou: {{ item.c }}</span>
              {% else %}
                <span class="badge rounded-pill badge-accent">{{ item.status }}: {{ item.c }}</span>
              {% endif %}
            {% endfor %}
          </div>
        {% else %}
          <div class="muted">Sem agendamentos hoje.</div>
        {% endif %}
      </div>
    </div>
  </div>
  <div class="col-lg-6">
    <div class="card card-panel mb-4">
      <div class="card-header d-flex justify-content-between align-items-center">
        <span class="fw-semibold">Agendamentos recentes</span>
        <div>
          <a href="#" class="btn btn-sm btn-outline-light">Gerenciar serviços</a>
          <a href="#" class="btn btn-sm btn-accent">Nova venda</a>
        </div>
      </div>
      <div class="card-body p-0">
        <table class="table table-dark table-striped mb-0">
          <thead>
            <tr>
              <th style="width: 80px;">Hora</th>
              <th>Barbeiro</th>
              <th>Cliente</th>
              <th>Telefone</th>
              <th>Serviço</th>
              <th style="width: 140px;">Agendado em</th>
              <th style="width: 140px;">Status</th>
            </tr>
          </thead>
          <tbody>
            {% for a in appointments_today %}
            <tr>
              <td>{{ a.start_datetime|date:'H:i' }}</td>
              <td>{{ a.barber.display_name|default:a.barber.username }}</td>
              <td>{{ a.client_name }}</td>
              <td>{{ a.client_phone }}</td>
              <td>{{ a.service.title }}</td>
              <td>{{ a.created_at|date:'d/m H:i' }}</td>
              <td>
                {% if a.status == 'scheduled' %}
                  <span class="badge rounded-pill text-bg-secondary">Agendado</span>
                {% elif a.status == 'done' %}
                  <span class="badge rounded-pill bg-success">Concluído</span>
                {% elif a.status == 'cancelled' %}
                  <span class="badge rounded-pill bg-danger">Cancelado</span>
                {% else %}
                  <span class="badge rounded-pill badge-accent">{{ a.status }}</span>
                {% endif %}
              </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="7" class="text-center muted">Sem registros.</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<div class="alert alert-warning">Você possui acesso total aos dados da barbearia.</div>
{% endblock %}